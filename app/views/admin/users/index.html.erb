<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Users</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  
  <body class="m-0 h-screen w-screen overflow-hidden">
    <div class="flex h-screen w-full">
      <div>
        <%= render 'users/shared/adminSB' %>
      </div>

      <div class="flex-1 overflow-y-auto p-6 ml-64 bg-white" id="admin-users">
        <div class="max-w-6xl w-full mx-auto p-6 bg-white rounded-xl shadow-md">
          <h2 class="text-2xl font-semibold mb-4 text-gray-800">All Users</h2>

          <%= search_form_for @q, url: admin_users_path, method: :get, class: "mb-4 flex gap-2" do |f| %>
            <%= f.search_field :first_name_or_last_name_or_email_cont,
              placeholder: "Search by name or email",
              class: "px-4 py-2 border border-gray-300 rounded-md w-64" 
            %>

            <%= f.select :is_pending_eq,
              options_for_select([["Any", ""], ["Pending", true], ["Approved", false]], params.dig(:q, :is_pending_eq)),
              {}, 
              class: "px-4 py-2 border border-gray-300 rounded-md"
            %>

            <%= f.select :is_admin_eq,
              options_for_select([["Any Role", ""], ["Admin", true], ["Trader", false]], params.dig(:q, :is_admin_eq)),
              {},
              class: "px-4 py-2 border border-gray-300 rounded-md"
            %>
            
            <%= f.submit "Search",
              class: "px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors" 
            %>

            <%= link_to "Clear", admin_users_path, class: "px-4 py-2 bg-rose-500 text-white rounded-md hover:bg-rose-600 transition-colors" %>
          <% end %>

          <div class="overflow-x-auto">
            <table class="min-w-full border text-sm text-gray-700">
              <thead>
                <tr class="bg-gray-100 text-left text-xs uppercase tracking-wider text-gray-600">
                  <th class="px-4 py-3">Email</th>
                  <th class="px-4 py-3">First Name</th>
                  <th class="px-4 py-3">Last Name</th>
                  <th class="px-4 py-3">Status</th>
                  <th class="px-4 py-3">Actions</th>
                </tr>
              </thead>
              <tbody>
                <% @users.each do |user| %>
                  <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-2 font-medium text-gray-800"><%= user.email %></td>
                    <td class="px-4 py-2"><%= user.first_name %></td>
                    <td class="px-4 py-2"><%= user.last_name %></td>
                    <td class="px-4 py-2">
                      <% if user.is_admin %>
                        <span class="inline-block px-2 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-800">
                          Admin
                        </span>
                      <% elsif user.is_pending %>
                        <span class="inline-block px-2 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800">
                          Pending
                        </span>
                      <% else %>
                        <span class="inline-block px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                          Approved
                        </span>
                      <% end %>
                    </td>
                    <td class="px-4 py-2 space-x-2 flex flex-wrap gap-2">
                      <%= link_to "Details",
                        admin_user_path(user),
                        class: "inline-block px-3 py-1 text-xs font-medium rounded bg-blue-600 text-white hover:bg-blue-700 transition-colors" %>

                      <%= link_to "Edit",
                        edit_admin_user_path(user),
                        class: "inline-block px-3 py-1 text-xs font-medium rounded bg-yellow-400 text-black hover:bg-yellow-500 transition-colors" %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
            <div class="mt-6 flex justify-center">
              <%= paginate @users, params: { q: params[:q] } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
